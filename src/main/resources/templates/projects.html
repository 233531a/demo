<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–µ–∫—Ç—ã ‚Äî –ú–æ–∏–ü—Ä–æ–µ–∫—Ç—ã</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" th:href="@{/css/style.css?v=2}">
</head>
<body>
<header class="topbar">
    <div class="topbar__left">
        <a th:href="@{/?}" class="brand">–ú–æ–∏–ü—Ä–æ–µ–∫—Ç—ã</a>
        <a th:href="@{/projects}" class="topbar__link active">–ü—Ä–æ–µ–∫—Ç—ã</a>
    </div>
    <div class="topbar__right">
        <span class="user-chip" sec:authorize="isAuthenticated()">
            <span class="user-avatar">üë§</span>
            <b sec:authentication="name"></b>
        </span>
        <a sec:authorize="isAnonymous()" th:href="@{/login}" class="button ghost">–í–æ–π—Ç–∏</a>
        <a sec:authorize="isAnonymous()" th:href="@{/register}" class="button primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        <form sec:authorize="isAuthenticated()" th:action="@{/logout}" method="post" style="display:inline">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="button danger ghost">–í—ã–π—Ç–∏</button>
        </form>

    </div>
</header>

<main class="page">
    <div class="page__header">
        <div>
            <h1>–ü—Ä–æ–µ–∫—Ç—ã</h1>
            <p class="muted">–ó–¥–µ—Å—å –≤–∏–¥–µ–Ω –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤.</p>
        </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è ADMIN -->
    <section class="card" sec:authorize="hasRole('ADMIN')">
        <div class="card__header">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</h2>
        </div>
        <form th:action="@{/projects/add}" th:object="${project}" method="post" class="form-grid">
            <div class="form-field">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                <input type="text" th:field="*{projectName}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: CRM v2" required>
                <div class="error" th:if="${#fields.hasErrors('projectName')}" th:errors="*{projectName}"></div>
            </div>
            <div class="form-field">
                <label>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</label>
                <input type="text" th:field="*{manager}" placeholder="–§–ò–û" required>
                <div class="error" th:if="${#fields.hasErrors('manager')}" th:errors="*{manager}"></div>
            </div>
            <div class="form-field">
                <label>–î–µ–¥–ª–∞–π–Ω</label>
                <input type="date" th:field="*{deadline}" required>
                <div class="error" th:if="${#fields.hasErrors('deadline')}" th:errors="*{deadline}"></div>
            </div>

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <div class="form-actions">
                <button type="submit" class="button primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </section>

    <section class="card">
        <div class="card__header">
            <h2>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤</h2>
        </div>
        <div class="table-wrapper" th:if="${!projects.isEmpty()}">
            <table class="table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                    <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                    <th>–î–µ–¥–ª–∞–π–Ω</th>
                    <th sec:authorize="hasRole('ADMIN')" class="actions-col">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="project, i : ${projects}">
                    <td th:text="${i.index + 1}">1</td>
                    <td th:text="${project.projectName}">–ù–∞–∑–≤–∞–Ω–∏–µ</td>
                    <td th:text="${project.manager}">–ú–µ–Ω–µ–¥–∂–µ—Ä</td>
                    <td th:text="${project.deadline}">2025-12-31</td>
                    <td sec:authorize="hasRole('ADMIN')" class="actions-col">
                        <a class="button ghost small" th:href="@{'/projects/edit/' + ${project.id}}">‚úèÔ∏è</a>
                        <form th:action="@{'/projects/delete/' + ${project.id}}"
                              method="post" class="inline-form"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?');">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <button type="submit" class="button danger small">üóë</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <p class="muted" th:if="${projects.isEmpty()}">–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç.</p>
    </section>
</main>

<footer class="footer">
    <small>¬© 2025 –ú–æ–∏–ü—Ä–æ–µ–∫—Ç—ã</small>
</footer>
</body>
</html>
